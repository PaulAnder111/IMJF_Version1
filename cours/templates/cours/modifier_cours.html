{% extends 'utilisateurs/base.html' %}
{% load static %}

{% block title %}Modifier le Cours - SYGEE{% endblock %}

{% block content %}
{# messages handled globally by base.html #}

<!-- SECTION HEADER AVEC GRADIENT (GRIS FONSE → OR) -->
<div class="bg-gradient-to-r from-gray-800 to-amber-500 py-4 px-3 sm:px-6 text-white shadow-md mb-6 rounded-lg">
  <div class="max-w-7xl mx-auto flex flex-col sm:flex-row justify-between items-center gap-2">
    <div class="text-center sm:text-left">
      <h1 class="text-2xl font-bold mb-1">Modifier le Cours</h1>
      <p class="text-white/80 text-sm">Modifiez les informations du cours</p>
    </div>
    <a href="{% url 'cours:cours' %}"
       class="inline-flex items-center px-4 py-2 bg-white/20 text-white font-semibold rounded-lg shadow-md hover:bg-white/30 transform hover:scale-105 transition-all duration-300 ease-in-out text-sm border border-white/30">
      <i class="fas fa-arrow-left mr-2"></i> Retour à la liste
    </a>
  </div>
</div>

<div class="max-w-7xl mx-auto px-4">
  <!-- CARTE DU FORMULAIRE -->
  <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-amber-200">
    <!-- En-tête de la carte -->
    <div class="bg-gradient-to-r from-amber-500 to-amber-600 px-6 py-4">
      <h2 class="text-xl font-bold text-white flex items-center">
        <i class="fas fa-edit mr-3 text-white"></i> Modifier les informations du cours
      </h2>
      <p class="text-white/80 text-sm mt-1">Mettez à jour les informations du cours "{{ cours.matiere.nom|default:cours.matiere }}"</p>
    </div>

    <!-- Formulaire -->
    <div class="p-6">
      <form method="POST" class="space-y-6">
        {% csrf_token %}

        <!-- LIGNE 1 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <!-- Matière -->
          <div class="form-group">
            <label class="block font-semibold text-gray-700 mb-2 text-sm flex items-center">
              <i class="fas fa-book text-amber-500 mr-2"></i> Matière *
            </label>
            <select name="matiere" required class="form-field-modern">
              <!-- placeholder removed; choose a matière -->
              {% for matiere in matieres %}
                <option value="{{ matiere.id }}" {% if matiere.id == cours.matiere.id %}selected{% endif %}>
                  {{ matiere.nom_matiere }}
                </option>
              {% endfor %}
            </select>
          </div>

          <!-- Classe -->
          <div class="form-group">
            <label class="block font-semibold text-gray-700 mb-2 text-sm flex items-center">
              <i class="fas fa-users text-amber-500 mr-2"></i> Classe *
            </label>
            <select name="classe" required class="form-field-modern">
              <!-- placeholder removed; choose a classe -->
              {% for classe in classes %}
                <option value="{{ classe.id }}" {% if classe.id == cours.classe.id %}selected{% endif %}>
                  {{ classe.nom_classe }}
                </option>
              {% endfor %}
            </select>
          </div>

          <!-- Enseignant -->
          <div class="form-group">
            <label class="block font-semibold text-gray-700 mb-2 text-sm flex items-center">
              <i class="fas fa-chalkboard-teacher text-amber-500 mr-2"></i> Enseignant *
            </label>
            <select name="enseignant" required class="form-field-modern">
              <!-- placeholder removed; choose an enseignant -->
              {% for enseignant in enseignants %}
                <option value="{{ enseignant.id }}" {% if enseignant.id == cours.enseignant.id %}selected{% endif %}>
                  {{ enseignant.prenom }} {{ enseignant.nom }}
                </option>
              {% endfor %}
            </select>
          </div>
        </div>

        <!-- LIGNE 2 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <!-- Jour -->
          <div class="form-group">
            <label class="block font-semibold text-gray-700 mb-2 text-sm flex items-center">
              <i class="fas fa-calendar-day text-amber-500 mr-2"></i> Jour *
            </label>
            <select name="jour" required class="form-field-modern">
              <option value="Lundi" {% if cours.jour == 'Lundi' %}selected{% endif %}>Lundi</option>
              <option value="Mardi" {% if cours.jour == 'Mardi' %}selected{% endif %}>Mardi</option>
              <option value="Mercredi" {% if cours.jour == 'Mercredi' %}selected{% endif %}>Mercredi</option>
              <option value="Jeudi" {% if cours.jour == 'Jeudi' %}selected{% endif %}>Jeudi</option>
              <option value="Vendredi" {% if cours.jour == 'Vendredi' %}selected{% endif %}>Vendredi</option>
              <option value="Samedi" {% if cours.jour == 'Samedi' %}selected{% endif %}>Samedi</option>
            </select>
          </div>

          <!-- Heure début -->
          <div class="form-group">
            <label class="block font-semibold text-gray-700 mb-2 text-sm flex items-center">
              <i class="fas fa-clock text-amber-500 mr-2"></i> Heure début *
            </label>
            <input type="time" name="heure_debut" value="{{ cours.heure_debut|time:'H:i' }}" required class="form-field-modern">
          </div>

          <!-- Heure fin -->
          <div class="form-group">
            <label class="block font-semibold text-gray-700 mb-2 text-sm flex items-center">
              <i class="fas fa-clock text-amber-500 mr-2"></i> Heure fin *
            </label>
            <input type="time" name="heure_fin" value="{{ cours.heure_fin|time:'H:i' }}" required class="form-field-modern">
          </div>
        </div>

        <!-- LIGNE 3 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <!-- Salle -->
          <div class="form-group">
            <label class="block font-semibold text-gray-700 mb-2 text-sm flex items-center">
              <i class="fas fa-door-open text-amber-500 mr-2"></i> Salle
            </label>
            <input type="text" name="salle" value="{{ cours.salle }}" class="form-field-modern" placeholder="Ex: Salle B3, Labo Informatique...">
          </div>

          <!-- Statut -->
          <div class="form-group">
            <label class="block font-semibold text-gray-700 mb-2 text-sm flex items-center">
              <i class="fas fa-info-circle text-amber-500 mr-2"></i> Statut *
            </label>
            <select name="statut" required class="form-field-modern">
              <option value="actif" {% if cours.statut == 'actif' %}selected{% endif %}>Actif</option>
              <option value="inactif" {% if cours.statut == 'inactif' %}selected{% endif %}>Inactif</option>
            </select>
          </div>

          <!-- Champ optionnel pour compléter la grille -->
          <div class="form-group">
            <label class="block font-semibold text-gray-700 mb-2 text-sm flex items-center">
              <i class="fas fa-calendar-alt text-amber-500 mr-2"></i> Dernière modification
            </label>
            <div class="form-field-modern bg-gray-50 text-gray-500 flex items-center">
              <i class="fas fa-history mr-2 text-amber-500"></i>
              {{ cours.updated_at|default:"Maintenant" }}
            </div>
          </div>
        </div>

        <!-- BOUTONS -->
        <div class="flex flex-col sm:flex-row justify-end pt-6 gap-3 border-t border-gray-200">
          <a href="{% url 'cours:cours' %}" 
             class="inline-flex items-center justify-center px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg transition shadow-md transform hover:scale-105 text-sm">
            <i class="fas fa-times mr-2"></i> Annuler
          </a>
          <button type="submit" 
                  class="inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white font-semibold rounded-lg transition shadow-md transform hover:scale-105 text-sm">
            <i class="fas fa-save mr-2"></i> Mettre à jour
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- CARTE INFORMATIONS COURS ACTUEL -->
  <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl border border-blue-200 shadow-sm p-6 mt-6">
    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
      <i class="fas fa-info-circle text-blue-500 mr-2"></i> Informations actuelles du cours
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div class="bg-white rounded-lg p-4 border border-blue-200">
        <p class="text-sm text-gray-600 font-semibold">Matière actuelle</p>
        <p class="text-lg font-bold text-gray-800">{{ cours.matiere.nom|default:cours.matiere }}</p>
      </div>
      <div class="bg-white rounded-lg p-4 border border-blue-200">
        <p class="text-sm text-gray-600 font-semibold">Classe actuelle</p>
        <p class="text-lg font-bold text-gray-800">{{ cours.classe.nom_classe|default:cours.classe }}</p>
      </div>
      <div class="bg-white rounded-lg p-4 border border-blue-200">
        <p class="text-sm text-gray-600 font-semibold">Enseignant actuel</p>
        <p class="text-lg font-bold text-gray-800">{{ cours.enseignant.nom }} {{ cours.enseignant.prenom }}</p>
      </div>
    </div>
  </div>
</div>

<!-- STYLES MODERNES -->
<style>
.form-group {
  display: flex;
  flex-direction: column;
}

.form-field-modern {
  width: 100%;
  padding: 0.75rem 1rem;
  border: 2px solid #e5e7eb;
  border-radius: 0.75rem;
  outline: none;
  transition: all 0.3s ease;
  font-size: 0.875rem;
  background-color: white;
  color: #374151;
}

.form-field-modern:focus {
  border-color: #f59e0b;
  box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
  background-color: white;
}

.form-field-modern::placeholder {
  color: #9ca3af;
}

/* Style pour les selects */
.form-field-modern {
  appearance: none;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
  background-position: right 1rem center;
  background-repeat: no-repeat;
  background-size: 1.25em 1.25em;
  padding-right: 2.5rem;
}

/* Style pour le champ statique */
.bg-gray-50 {
  background-color: #f9fafb;
}

/* Responsive design */
@media (max-width: 768px) {
  .grid-cols-3 {
    grid-template-columns: 1fr;
  }
  
  .grid-cols-2 {
    grid-template-columns: 1fr;
  }
  
  .p-6 {
    padding: 1rem;
  }
  
  .gap-4 {
    gap: 1rem;
  }
}

/* Animation pour les boutons */
.bg-gradient-to-r {
  transition: all 0.3s ease;
}

.bg-gradient-to-r:hover {
  transform: translateY(-1px);
}
</style>

<script>
// Script pour améliorer l'expérience utilisateur
document.addEventListener('DOMContentLoaded', function() {
  // Focus sur le premier champ
  const firstField = document.querySelector('.form-field-modern');
  if (firstField) {
    firstField.focus();
  }

  // Validation des heures
  const heureDebut = document.querySelector('input[name="heure_debut"]');
  const heureFin = document.querySelector('input[name="heure_fin"]');

  if (heureDebut && heureFin) {
    heureFin.addEventListener('change', function() {
      if (heureDebut.value && heureFin.value) {
        if (heureFin.value <= heureDebut.value) {
          alert('L\'heure de fin doit être après l\'heure de début');
          heureFin.value = '';
          heureFin.focus();
        }
      }
    });
  }

  // Animation des champs au focus
  const fields = document.querySelectorAll('.form-field-modern');
  fields.forEach(field => {
    field.addEventListener('focus', function() {
      this.parentElement.classList.add('field-focused');
    });
    
    field.addEventListener('blur', function() {
      this.parentElement.classList.remove('field-focused');
    });
  });

  // Confirmation avant de quitter si des modifications ont été faites
  let formModified = false;
  const form = document.querySelector('form');
  const initialFormData = new FormData(form);

  form.addEventListener('input', function() {
    formModified = true;
  });

  window.addEventListener('beforeunload', function(e) {
    if (formModified) {
      e.preventDefault();
      e.returnValue = 'Vous avez des modifications non enregistrées. Êtes-vous sûr de vouloir quitter ?';
    }
  });

  // Réinitialiser le flag quand le formulaire est soumis
  form.addEventListener('submit', function() {
    formModified = false;
  });
});
</script>
{% endblock %}