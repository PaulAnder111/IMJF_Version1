{% extends "utilisateurs/base.html" %}

{% block head_extra %}
  <style>
    .transition-all { transition: all 0.3s ease; }
  </style>
{% endblock %}

{% block body_class %}bg-gray-50 min-h-screen p-6{% endblock %}

{% block content %}
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">Modifier les informations de l'élève</h1>

        <div class="bg-white rounded-xl shadow-md p-6">
            <form id="modification-form">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="nom-modif" class="block text-sm font-medium text-gray-700 mb-1">Nom complet</label>
                        <input type="text" id="nom-modif" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all" required>
                    </div>

                    <div>
                        <label for="date-naissance-modif" class="block text-sm font-medium text-gray-700 mb-1">Date de naissance</label>
                        <input type="date" id="date-naissance-modif" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all" required>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Sexe</label>
                        <div class="flex space-x-4">
                            <label class="inline-flex items-center">
                                <input type="radio" name="sexe-modif" value="H" class="text-amber-500 focus:ring-amber-500">
                                <span class="ml-2">Homme</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="sexe-modif" value="F" class="text-amber-500 focus:ring-amber-500">
                                <span class="ml-2">Femme</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <label for="classe-modif" class="block text-sm font-medium text-gray-700 mb-1">Classe</label>
                        <select id="classe-modif" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all" required>
                            <option value="Seconde">Seconde</option>
                            <option value="7eme">7eme</option>
                            <option value="8eme">8eme</option>
                            <option value="9eme">9eme</option>
                            <option value="NSI">NSI</option>
                            <option value="NSII">NSII</option>
                            <option value="NSIII">NSIII</option>
                            <option value="NSIV">NSIV</option>
                        </select>
                    </div>

                    <div class="md:col-span-2">
                        <label for="adresse-modif" class="block text-sm font-medium text-gray-700 mb-1">Adresse</label>
                        <textarea id="adresse-modif" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all" required></textarea>
                    </div>

                    <div>
                        <label for="telephone-modif" class="block text-sm font-medium text-gray-700 mb-1">Téléphone</label>
                        <input type="tel" id="telephone-modif" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all" required>
                    </div>
                </div>

                <div class="flex justify-end space-x-4 mt-8">
                    <a href="{% url 'eleves:eleves' %}" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-6 rounded-lg transition-all transform hover:scale-105">
                        Annuler
                    </a>
                    <button type="submit" class="bg-amber-500 hover:bg-amber-600 text-white font-medium py-2 px-6 rounded-lg transition-all transform hover:scale-105">
                        Mettre à jour
                    </button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const eleves = JSON.parse(localStorage.getItem('eleves')) || [];
        if (eleves.length > 0) {
            const eleve = eleves[0];
            const details = eleve.details || {};
            document.getElementById('nom-modif').value = eleve.nom;
            document.getElementById('date-naissance-modif').value = details.dateNaissance || '2005-03-15';
            if (details.sexe === 'H') { document.querySelector('input[name="sexe-modif"][value="H"]').checked = true; }
            else if (details.sexe === 'F') { document.querySelector('input[name="sexe-modif"][value="F"]').checked = true; }
            document.getElementById('classe-modif').value = eleve.classe;
            document.getElementById('adresse-modif').value = details.adresse || '';
            document.getElementById('telephone-modif').value = details.telephone || '';
        }
    });

    document.getElementById('modification-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = { 
            nom: document.getElementById('nom-modif').value, 
            dateNaissance: document.getElementById('date-naissance-modif').value, 
            sexe: document.querySelector('input[name="sexe-modif"]:checked').value, 
            classe: document.getElementById('classe-modif').value, 
            adresse: document.getElementById('adresse-modif').value, 
            telephone: document.getElementById('telephone-modif').value 
        };
        let eleves = JSON.parse(localStorage.getItem('eleves')) || [];
        if (eleves.length > 0) { 
            eleves[0].nom = formData.nom; 
            eleves[0].classe = formData.classe; 
            eleves[0].details = formData; 
            localStorage.setItem('eleves', JSON.stringify(eleves)); 
        }
        alert('Informations mises à jour avec succès!');
        window.location.href = "{% url 'eleves:eleves' %}";
    });
</script>
{% endblock %}
