{% extends "utilisateurs/base.html" %}

{% block title %}Nouvelle Inscription - IMJF{% endblock %}

{% block content %}
<div class="container mx-auto px-3 sm:px-4 max-w-6xl">
    <!-- Header Section compact -->
    <div class="bg-gradient-to-r from-gray-600 via-gray-500 to-gray-600 rounded-lg shadow-md p-3 sm:p-4 mb-4 border border-yellow-300/20">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-2">
            <div class="flex items-center space-x-2">
                <div class="bg-gradient-to-br from-yellow-400 to-yellow-500 p-2 rounded-lg">
                    <i class="fas fa-user-plus text-white text-sm sm:text-base"></i>
                </div>
                <div class="text-center sm:text-left">
                    <h1 class="text-lg sm:text-xl font-bold text-white">Nouvelle Inscription</h1>
                    <p class="text-gray-200 text-xs">Enregistrer un nouvel √©l√®ve</p>
                </div>
            </div>
            <a href="{% url 'inscriptions:inscription_list' %}" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all flex items-center space-x-2 w-full sm:w-auto justify-center">
                <i class="fas fa-arrow-left text-xs"></i>
                <span class="text-xs sm:text-sm">Retour</span>
            </a>
        </div>
    </div>

    <!-- Form Section compacte et horizontale -->
    <div class="bg-white rounded-lg shadow-md border border-gray-200">
        <form method="POST" enctype="multipart/form-data" id="inscriptionForm">
            {% csrf_token %}
            
            {% if form.errors %}
            <div class="bg-red-50 border-l-4 border-red-500 p-3 m-4 rounded">
                <div class="flex items-center">
                    <i class="fas fa-exclamation-circle text-red-500 mr-2"></i>
                    <p class="text-red-700 text-sm">Veuillez corriger les erreurs ci-dessous</p>
                </div>
            </div>
            {% endif %}

            <!-- Grid principal horizontal -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 p-4">
                
                <!-- Colonne 1: Informations Personnelles -->
                <div class="space-y-3">
                    <div class="flex items-center mb-2">
                        <div class="bg-yellow-500 w-1 h-4 rounded mr-2"></div>
                        <h3 class="text-sm font-bold text-gray-700 flex items-center">
                            <i class="fas fa-user text-yellow-500 mr-1 text-xs"></i>
                            Informations Personnelles
                        </h3>
                    </div>

                    <!-- Nom -->
                    <div class="space-y-1">
                        <label for="id_nom" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-signature text-yellow-500 mr-1 text-xs"></i>
                            Nom <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="text" name="nom" id="id_nom" required
                            placeholder="JEAN"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-yellow-500 text-sm uppercase">
                    </div>

                    <!-- Pr√©nom -->
                    <div class="space-y-1">
                        <label for="id_prenom" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-signature text-yellow-500 mr-1 text-xs"></i>
                            Pr√©nom <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="text" name="prenom" id="id_prenom" required
                            placeholder="Marie"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-yellow-500 text-sm capitalize">
                    </div>

                    <!-- Date de Naissance -->
                    <div class="space-y-1">
                        <label for="id_date_naissance" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-calendar-day text-yellow-500 mr-1 text-xs"></i>
                            Date Naissance <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="date" name="date_naissance" id="id_date_naissance" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-yellow-500 text-sm">
                    </div>

                    <!-- Sexe -->
                    <div class="space-y-1">
                        <label for="id_sexe" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-venus-mars text-yellow-500 mr-1 text-xs"></i>
                            Sexe <span class="text-red-500 ml-1">*</span>
                        </label>
                        <select name="sexe" id="id_sexe" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-yellow-500 text-sm">
                            <option value="">-- S√©lectionner --</option>
                            <option value="M">Masculin</option>
                            <option value="F">F√©minin</option>
                        </select>
                    </div>
                </div>

                <!-- Colonne 2: Informations Acad√©miques -->
                <div class="space-y-3">
                    <div class="flex items-center mb-2">
                        <div class="bg-blue-500 w-1 h-4 rounded mr-2"></div>
                        <h3 class="text-sm font-bold text-gray-700 flex items-center">
                            <i class="fas fa-graduation-cap text-blue-500 mr-1 text-xs"></i>
                            Informations Acad√©miques
                        </h3>
                    </div>

                    <!-- Niveau -->
                    <div class="space-y-1">
                        <label for="id_niveau" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-layer-group text-yellow-500 mr-1 text-xs"></i>
                            Niveau <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="text" name="niveau" id="id_niveau" required
                            placeholder="6e ann√©e"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-yellow-500 text-sm">
                    </div>

                    <!-- Classe -->
                    <div class="space-y-1">
                        <label for="id_classe" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-door-open text-yellow-500 mr-1 text-xs"></i>
                            Classe <span class="text-red-500 ml-1">*</span>
                        </label>
                        <select name="classe" id="id_classe" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-yellow-500 text-sm">
                            <option value="">-- S√©lectionner --</option>
                            {% for classe in classes %}
                                <option value="{{ classe.id }}">{{ classe.nom_classe }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Ann√©e Scolaire -->
                    <div class="space-y-1">
                        <label for="id_annee_scolaire" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-calendar-alt text-yellow-500 mr-1 text-xs"></i>
                            Ann√©e Scolaire <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="text" name="annee_scolaire" id="id_annee_scolaire" value="2025-2026" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-yellow-500 text-sm">
                    </div>

                    <!-- Statut -->
                    <div class="space-y-1">
                        <label for="id_statut" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-info-circle text-yellow-500 mr-1 text-xs"></i>
                            Statut <span class="text-red-500 ml-1">*</span>
                        </label>
                        <select name="statut" id="id_statut" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-yellow-500 text-sm">
                            <option value="pre-inscrit">‚è≥ Pr√©-inscrit</option>
                            <option value="aktif">üü¢ Actif</option>
                            <option value="refize">‚ùå Refus√©</option>
                        </select>
                    </div>
                </div>

                <!-- Colonne 3: Informations Responsable -->
                <div class="space-y-3">
                    <div class="flex items-center mb-2">
                        <div class="bg-purple-500 w-1 h-4 rounded mr-2"></div>
                        <h3 class="text-sm font-bold text-gray-700 flex items-center">
                            <i class="fas fa-users text-purple-500 mr-1 text-xs"></i>
                            Responsable L√©gal
                        </h3>
                    </div>

                    <!-- Nom Responsable -->
                    <div class="space-y-1">
                        <label for="id_personne_responsable" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-user text-yellow-500 mr-1 text-xs"></i>
                            Nom Responsable <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="text" name="personne_responsable" id="id_personne_responsable" required
                            placeholder="Jean BAPTISTE"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-yellow-500 text-sm">
                    </div>

                    <!-- Profession -->
                    <div class="space-y-1">
                        <label for="id_profession_responsable" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-briefcase text-yellow-500 mr-1 text-xs"></i>
                            Profession <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="text" name="profession_responsable" id="id_profession_responsable" required
                            placeholder="Ing√©nieur"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-yellow-500 text-sm">
                    </div>

                    <!-- T√©l√©phone -->
                    <div class="space-y-1">
                        <label for="id_telephone_responsable" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-phone text-yellow-500 mr-1 text-xs"></i>
                            T√©l√©phone <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="tel" name="telephone_responsable" id="id_telephone_responsable" required
                            placeholder="+509 1234-5678"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-yellow-500 text-sm">
                    </div>

                    <!-- Email -->
                    <div class="space-y-1">
                        <label for="id_email_responsable" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-envelope text-yellow-500 mr-1 text-xs"></i>
                            Email (Optionnel)
                        </label>
                        <input type="email" name="email_responsable" id="id_email_responsable"
                            placeholder="email@exemple.com"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-yellow-500 text-sm">
                    </div>
                </div>
            </div>

            <!-- Champs pleine largeur en dessous -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 p-4 border-t border-gray-200">
                <!-- Lieu de Naissance -->
                <div class="space-y-1">
                    <label for="id_lieu_naissance" class="block text-xs font-semibold text-gray-600 flex items-center">
                        <i class="fas fa-map-marker-alt text-yellow-500 mr-1 text-xs"></i>
                        Lieu de Naissance <span class="text-red-500 ml-1">*</span>
                    </label>
                    <input type="text" name="lieu_naissance" id="id_lieu_naissance" required
                        placeholder="Port-au-Prince, Ha√Øti"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-yellow-500 text-sm">
                </div>

                <!-- √âcole d'origine -->
                <div class="space-y-1">
                    <label for="id_ecole_origine" class="block text-xs font-semibold text-gray-600 flex items-center">
                        <i class="fas fa-school text-yellow-500 mr-1 text-xs"></i>
                        √âcole d'origine (Optionnel)
                    </label>
                    <input type="text" name="ecole_origine" id="id_ecole_origine"
                        placeholder="√âcole Sainte-Marie"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-yellow-500 text-sm">
                </div>

                <!-- Adresse Compl√®te -->
                <div class="lg:col-span-2 space-y-1">
                    <label for="id_adresse" class="block text-xs font-semibold text-gray-600 flex items-center">
                        <i class="fas fa-home text-yellow-500 mr-1 text-xs"></i>
                        Adresse Compl√®te <span class="text-red-500 ml-1">*</span>
                    </label>
                    <textarea name="adresse" id="id_adresse" rows="2" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-yellow-500 text-sm resize-vertical"
                        placeholder="123 Rue Jean-Jacques Dessalines, Delmas 33, Port-au-Prince"></textarea>
                </div>
            </div>

            <!-- Buttons Section compacte -->
            <div class="bg-gray-50 p-4 border-t border-gray-200 rounded-b-lg">
                <div class="flex flex-col sm:flex-row items-center justify-between gap-3">
                    <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto order-2 sm:order-1">
                        <button type="reset" 
                            class="w-full sm:w-auto px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white text-sm font-medium rounded-lg transition-all flex items-center justify-center space-x-2">
                            <i class="fas fa-redo text-xs"></i>
                            <span>R√©initialiser</span>
                        </button>
                        
                        <button type="submit" 
                            class="w-full sm:w-auto px-6 py-2 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white text-sm font-bold rounded-lg transition-all flex items-center justify-center space-x-2 shadow-md">
                            <i class="fas fa-check-circle text-xs"></i>
                            <span>Enregistrer</span>
                        </button>
                    </div>
                    
                    <a href="{% url 'inscriptions:inscription_list' %}" 
                        class="w-full sm:w-auto px-4 py-2 bg-gray-400 hover:bg-gray-500 text-white text-sm font-medium rounded-lg transition-all flex items-center justify-center space-x-2 order-1 sm:order-2">
                        <i class="fas fa-times text-xs"></i>
                        <span>Annuler</span>
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Style CSS compact -->
<style>
    /* Styles optimis√©s pour compacit√© */
    .container {
        max-width: 1200px;
    }
    
    /* Am√©liorations responsive */
    @media (max-width: 1024px) {
        .grid-cols-3 {
            grid-template-columns: 1fr;
        }
    }
    
    @media (max-width: 640px) {
        .container {
            padding-left: 0.5rem;
            padding-right: 0.5rem;
        }
        
        .p-4 {
            padding: 1rem;
        }
        
        input, select, textarea {
            font-size: 14px;
            min-height: 40px;
        }
    }

    /* Animations l√©g√®res */
    input:focus, select:focus, textarea:focus {
        transform: translateY(-1px);
        transition: all 0.2s ease;
    }

    /* Optimisation pour petits √©crans */
    @media (max-width: 480px) {
        .text-lg {
            font-size: 1.125rem;
        }
        
        .space-y-3 > * + * {
            margin-top: 0.5rem;
        }
    }

    /* Style pour les selects */
    select {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 0.5rem center;
        background-repeat: no-repeat;
        background-size: 1em 1em;
        padding-right: 2rem;
    }
</style>

<!-- Script simplifi√© -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Auto-format du t√©l√©phone
        const phoneInput = document.getElementById('id_telephone_responsable');
        if (phoneInput) {
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.startsWith('509')) {
                    value = value.substring(3);
                }
                if (value.length > 0) {
                    value = '+509 ' + value;
                }
                if (value.length > 9) {
                    value = value.substring(0, 9) + '-' + value.substring(9, 13);
                }
                e.target.value = value;
            });
        }

        // Validation basique
        const form = document.getElementById('inscriptionForm');
        if (form) {
            form.addEventListener('submit', function(e) {
                const requiredFields = form.querySelectorAll('[required]');
                let isValid = true;

                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        isValid = false;
                        field.classList.add('border-red-500');
                    } else {
                        field.classList.remove('border-red-500');
                    }
                });

                if (!isValid) {
                    e.preventDefault();
                    alert('Veuillez remplir tous les champs obligatoires.');
                }
            });
        }

        // Reset des bordures lors de la saisie
        const inputs = form.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                if (this.value.trim()) {
                    this.classList.remove('border-red-500');
                }
            });
        });
    });
</script>
{% endblock %}