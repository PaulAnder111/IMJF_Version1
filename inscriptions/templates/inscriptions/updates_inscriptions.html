{% extends "utilisateurs/base.html" %}

{% block title %}Modifier Inscription - IMJF{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
    <!-- Header Section Compact -->
    <div class="bg-gradient-to-r from-gray-700 to-gray-800 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-col md:flex-row justify-between items-center">
            <div class="mb-3 md:mb-0 text-center md:text-left">
                <h1 class="text-xl sm:text-2xl font-bold text-white flex items-center justify-center md:justify-start">
                    <i class="fas fa-edit text-yellow-400 mr-2 text-xl sm:text-2xl"></i>
                    Modifier l'Inscription
                </h1>
                <p class="text-gray-300 text-xs sm:text-sm mt-1">Mettre √† jour les informations de l'√©l√®ve</p>
            </div>
            <a href="{% url 'inscriptions:inscription_list' %}" 
               class="inline-flex items-center justify-center bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-all duration-300 text-sm">
                <i class="fas fa-arrow-left mr-2"></i>
                Retour
            </a>
        </div>
    </div>

    <!-- Form Section Compact -->
    <div class="max-w-6xl mx-auto px-3 sm:px-4 lg:px-6 py-6">
        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
            <form method="POST" enctype="multipart/form-data" class="space-y-4">
                {% csrf_token %}
                
                <!-- Messages d'erreur/succ√®s -->
                {% if form.errors %}
                <div class="bg-red-50 border-l-4 border-red-500 p-3 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-circle text-red-500 text-lg mr-3"></i>
                        <div>
                            <p class="font-semibold text-red-800 text-sm">Erreurs dans le formulaire</p>
                            <ul class="text-xs text-red-600 mt-1">
                                {% for field, errors in form.errors.items %}
                                    {% for error in errors %}
                                        <li>{{ field }}: {{ error }}</li>
                                    {% endfor %}
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Section: Informations Personnelles -->
                <div class="border-l-4 border-yellow-500 pl-3">
                    <h2 class="text-lg font-bold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-user text-yellow-500 mr-2 text-sm"></i>
                        Informations Personnelles
                    </h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4">
                    <!-- Nom -->
                    <div class="form-group">
                        <label for="id_nom" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 flex items-center">
                            <i class="fas fa-signature text-yellow-500 mr-1 text-xs"></i>Nom
                            <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="text" name="nom" id="id_nom" value="{{ form.nom.value|default:'' }}" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all text-sm">
                    </div>

                    <!-- Pr√©nom -->
                    <div class="form-group">
                        <label for="id_prenom" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 flex items-center">
                            <i class="fas fa-signature text-yellow-500 mr-1 text-xs"></i>Pr√©nom
                            <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="text" name="prenom" id="id_prenom" value="{{ form.prenom.value|default:'' }}" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all text-sm">
                    </div>

                    <!-- Date de Naissance -->
                    <div class="form-group">
                        <label for="id_date_naissance" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 flex items-center">
                            <i class="fas fa-calendar-day text-yellow-500 mr-1 text-xs"></i>Date de Naissance
                            <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="date" name="date_naissance" id="id_date_naissance" value="{{ form.date_naissance.value|date:'Y-m-d' }}" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all text-sm">
                    </div>

                    <!-- Sexe -->
                    <div class="form-group">
                        <label for="id_sexe" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 flex items-center">
                            <i class="fas fa-venus-mars text-yellow-500 mr-1 text-xs"></i>Sexe
                            <span class="text-red-500 ml-1">*</span>
                        </label>
                        <select name="sexe" id="id_sexe" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all text-sm">
                            <option value="">S√©lectionner...</option>
                            <option value="M" {% if form.sexe.value == 'M' %}selected{% endif %}>Masculin</option>
                            <option value="F" {% if form.sexe.value == 'F' %}selected{% endif %}>F√©minin</option>
                        </select>
                    </div>

                    <!-- Lieu de Naissance -->
                    <div class="form-group">
                        <label for="id_lieu_naissance" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 flex items-center">
                            <i class="fas fa-map-marker-alt text-yellow-500 mr-1 text-xs"></i>Lieu de Naissance
                            <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="text" name="lieu_naissance" id="id_lieu_naissance" value="{{ form.lieu_naissance.value|default:'' }}" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all text-sm">
                    </div>

                    <!-- Adresse Compl√®te -->
                    <div class="md:col-span-2 form-group">
                        <label for="id_adresse" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 flex items-center">
                            <i class="fas fa-home text-yellow-500 mr-1 text-xs"></i>Adresse Compl√®te
                            <span class="text-red-500 ml-1">*</span>
                        </label>
                        <textarea name="adresse" id="id_adresse" rows="2" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all text-sm resize-none"
                            placeholder="Entrez l'adresse compl√®te...">{{ form.adresse.value|default:'' }}</textarea>
                    </div>
                </div>

                <!-- Section: Informations Acad√©miques -->
                <div class="border-l-4 border-blue-500 pl-3 mt-4">
                    <h2 class="text-lg font-bold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-graduation-cap text-blue-500 mr-2 text-sm"></i>
                        Informations Acad√©miques
                    </h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4">
                    <!-- Niveau -->
                    <div class="form-group">
                        <label for="id_niveau" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 flex items-center">
                            <i class="fas fa-layer-group text-yellow-500 mr-1 text-xs"></i>Niveau scolaire
                            <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="text" name="niveau" id="id_niveau" value="{{ form.niveau.value|default:'' }}" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all text-sm"
                            placeholder="Ex: 6e ann√©e">
                    </div>

                    <!-- Classe -->
                    <div class="form-group">
                        <label for="id_classe" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 flex items-center">
                            <i class="fas fa-door-open text-yellow-500 mr-1 text-xs"></i>Classe
                            <span class="text-red-500 ml-1">*</span>
                        </label>
                        <select name="classe" id="id_classe" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all text-sm">
                            <option value="">S√©lectionner une classe...</option>
                            {% for classe in classes %}
                                <option value="{{ classe.id }}" {% if form.classe.value == classe.id|stringformat:"s" %}selected{% endif %}>
                                    {{ classe.nom_classe }} - {{ classe.niveau }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Ann√©e Scolaire -->
                    <div class="form-group">
                        <label for="id_annee_scolaire" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 flex items-center">
                            <i class="fas fa-calendar-alt text-yellow-500 mr-1 text-xs"></i>Ann√©e Scolaire
                            <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="text" name="annee_scolaire" id="id_annee_scolaire" value="{{ form.annee_scolaire.value|default:'' }}" 
                            placeholder="Ex: 2025-2026" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all text-sm">
                    </div>

                    <!-- Statut -->
                    <div class="form-group">
                        <label for="id_statut" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 flex items-center">
                            <i class="fas fa-info-circle text-yellow-500 mr-1 text-xs"></i>Statut de l'inscription
                            <span class="text-red-500 ml-1">*</span>
                        </label>
                        <select name="statut" id="id_statut" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all text-sm">
                            <option value="pre-inscrit" {% if form.statut.value == 'pre-inscrit' %}selected{% endif %}>‚è≥ Pr√©-inscrit</option>
                            <option value="aktif" {% if form.statut.value == 'aktif' %}selected{% endif %}>üü¢ Actif</option>
                            <option value="refize" {% if form.statut.value == 'refize' %}selected{% endif %}>‚ùå Refus√©</option>
                        </select>
                    </div>
                </div>

                <!-- Section: Informations Responsable -->
                <div class="border-l-4 border-purple-500 pl-3 mt-4">
                    <h2 class="text-lg font-bold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-users text-purple-500 mr-2 text-sm"></i>
                        Informations du Responsable L√©gal
                    </h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4">
                    <!-- Nom Complet du Responsable -->
                    <div class="form-group">
                        <label for="id_personne_responsable" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 flex items-center">
                            <i class="fas fa-user text-yellow-500 mr-1 text-xs"></i>Nom Complet du Responsable
                            <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="text" name="personne_responsable" id="id_personne_responsable" value="{{ form.personne_responsable.value|default:'' }}" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all text-sm">
                    </div>

                    <!-- Profession du Responsable -->
                    <div class="form-group">
                        <label for="id_profession_responsable" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 flex items-center">
                            <i class="fas fa-briefcase text-yellow-500 mr-1 text-xs"></i>Profession du Responsable
                            <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="text" name="profession_responsable" id="id_profession_responsable" value="{{ form.profession_responsable.value|default:'' }}" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all text-sm">
                    </div>

                    <!-- T√©l√©phone du Responsable -->
                    <div class="form-group">
                        <label for="id_telephone_responsable" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 flex items-center">
                            <i class="fas fa-phone text-yellow-500 mr-1 text-xs"></i>T√©l√©phone du Responsable
                            <span class="text-red-500 ml-1">*</span>
                        </label>
                        <input type="tel" name="telephone_responsable" id="id_telephone_responsable" value="{{ form.telephone_responsable.value|default:'' }}" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all text-sm"
                            placeholder="+509 XXXX-XXXX">
                    </div>

                    <!-- Email du Responsable -->
                    <div class="form-group">
                        <label for="id_email_responsable" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 flex items-center">
                            <i class="fas fa-envelope text-yellow-500 mr-1 text-xs"></i>Email du Responsable (Optionnel)
                        </label>
                        <input type="email" name="email_responsable" id="id_email_responsable" value="{{ form.email_responsable.value|default:'' }}"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all text-sm"
                            placeholder="responsable@email.com">
                    </div>

                    <!-- √âcole d'origine -->
                    <div class="form-group">
                        <label for="id_ecole_origine" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 flex items-center">
                            <i class="fas fa-school text-yellow-500 mr-1 text-xs"></i>√âcole d'origine (Optionnel)
                        </label>
                        <input type="text" name="ecole_origine" id="id_ecole_origine" value="{{ form.ecole_origine.value|default:'' }}"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all text-sm"
                            placeholder="Ex: √âcole Sainte-Marie">
                    </div>
                </div>

                <!-- Buttons Section -->
                <div class="flex flex-col sm:flex-row items-center justify-end gap-3 pt-4 border-t border-gray-200">
                    <a href="{% url 'inscriptions:inscription_list' %}" 
                        class="w-full sm:w-auto inline-flex items-center justify-center bg-gray-300 hover:bg-gray-400 text-gray-700 font-medium px-4 py-2 rounded-lg transition-all duration-300 text-sm">
                        <i class="fas fa-times mr-2"></i>
                        Annuler
                    </a>
                    <button type="submit" 
                        class="w-full sm:w-auto inline-flex items-center justify-center bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white font-bold px-4 py-2 rounded-lg transition-all duration-300 text-sm shadow hover:shadow-lg">
                        <i class="fas fa-save mr-2"></i>
                        Enregistrer les modifications
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Styles pour am√©liorer la responsivit√© -->
<style>
.form-group {
    display: flex;
    flex-direction: column;
}

/* Assurer la compatibilit√© avec la sidebar */
@media (min-width: 1024px) {
    .min-h-screen {
        min-height: calc(100vh - 4rem);
    }
}

/* Responsive pour mobile */
@media (max-width: 768px) {
    .px-3 {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
    }
    
    .py-2 {
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
    }
    
    .gap-3 {
        gap: 0.75rem;
    }
    
    .text-lg {
        font-size: 1rem;
    }
    
    .p-4 {
        padding: 1rem;
    }
}

/* Ajustements pour tr√®s petits √©crans */
@media (max-width: 640px) {
    .grid-cols-2 {
        grid-template-columns: 1fr;
    }
    
    .text-xs {
        font-size: 0.75rem;
    }
    
    .px-3 {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
    }
    
    .py-2 {
        padding-top: 0.375rem;
        padding-bottom: 0.375rem;
    }
}

/* Am√©lioration de l'apparence des champs */
input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: #f59e0b;
    box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
}

/* Animation pour les boutons */
button, a {
    transition: all 0.3s ease;
}

/* Style pour les ic√¥nes */
.fas {
    width: 1rem;
    height: 1rem;
}
</style>

<!-- JavaScript pour am√©liorer l'exp√©rience utilisateur -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Formatage automatique du t√©l√©phone
    const telephoneInput = document.getElementById('id_telephone_responsable');
    if (telephoneInput) {
        telephoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.startsWith('509')) {
                value = value.substring(3);
            }
            if (value.length > 0) {
                value = '+509 ' + value;
            }
            if (value.length > 8) {
                value = value.substring(0, 9) + '-' + value.substring(9);
            }
            e.target.value = value;
        });
    }

    // Validation de la date de naissance
    const dateNaissanceInput = document.getElementById('id_date_naissance');
    if (dateNaissanceInput) {
        const today = new Date().toISOString().split('T')[0];
        dateNaissanceInput.max = today;
        
        dateNaissanceInput.addEventListener('change', function() {
            const selectedDate = new Date(this.value);
            const today = new Date();
            const minAgeDate = new Date(today.getFullYear() - 3, today.getMonth(), today.getDate());
            const maxAgeDate = new Date(today.getFullYear() - 25, today.getMonth(), today.getDate());
            
            if (selectedDate > minAgeDate) {
                alert('L\'√©l√®ve doit avoir au moins 3 ans.');
                this.value = '';
            } else if (selectedDate < maxAgeDate) {
                alert('L\'√©l√®ve ne peut pas avoir plus de 25 ans.');
                this.value = '';
            }
        });
    }

    // Auto-capitalization du nom
    const nomInput = document.getElementById('id_nom');
    if (nomInput) {
        nomInput.addEventListener('input', function() {
            this.value = this.value.toUpperCase();
        });
    }

    // Mise en forme du pr√©nom (premi√®re lettre en majuscule)
    const prenomInput = document.getElementById('id_prenom');
    if (prenomInput) {
        prenomInput.addEventListener('input', function() {
            this.value = this.value.charAt(0).toUpperCase() + this.value.slice(1).toLowerCase();
        });
    }
});
</script>
{% endblock %}