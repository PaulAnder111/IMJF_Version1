{% extends 'utilisateurs/base.html' %}
{% load static %}

{% block title %}Ajouter un Enseignant - SYGEE{% endblock %}

{% block content %}
{% include "messages_block.html" %}
<div class="container mx-auto px-3 sm:px-4 max-w-7xl">
    <!-- Header Section compact -->
    <div class="bg-gradient-to-r from-gray-600 via-gray-500 to-gray-600 rounded-lg shadow-md p-3 sm:p-4 mb-4 border border-yellow-300/20">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-2">
            <div class="flex items-center space-x-2">
                <div class="bg-gradient-to-br from-yellow-400 to-yellow-500 p-2 rounded-lg">
                    <i class="fas fa-chalkboard-teacher text-white text-sm sm:text-base"></i>
                </div>
                <div class="text-center sm:text-left">
                    <h1 class="text-lg sm:text-xl font-bold text-white">Ajouter un Enseignant</h1>
                    <p class="text-gray-200 text-xs">Enregistrer un nouvel enseignant dans le système</p>
                </div>
            </div>
            <a href="{% url 'enseignants:enseignants' %}" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all flex items-center space-x-2 w-full sm:w-auto justify-center">
                <i class="fas fa-arrow-left text-xs"></i>
                <span class="text-xs sm:text-sm">Retour</span>
            </a>
        </div>
    </div>

    <!-- Information Alert -->
    <div class="bg-blue-50 border-l-4 border-blue-500 p-3 rounded-lg mb-4">
        <div class="flex items-start">
            <i class="fas fa-info-circle text-blue-500 mr-2 mt-0.5"></i>
            <div>
                <p class="font-semibold text-blue-800 text-sm">Information importante</p>
                <p class="text-xs text-blue-700 mt-1">Les champs marqués d'un astérisque (<span class="text-red-500">*</span>) sont obligatoires.</p>
            </div>
        </div>
    </div>

    <!-- Form Section avec 3 colonnes -->
    <div class="bg-white rounded-lg shadow-md border border-gray-200">
        <form method="POST" enctype="multipart/form-data" id="enseignantForm">
            {% csrf_token %}
            
            <!-- Messages d'erreur -->
            {% if form.errors %}
            <div class="bg-red-50 border-l-4 border-red-500 p-3 m-4 rounded-lg">
                <div class="flex items-center">
                    <i class="fas fa-exclamation-circle text-red-500 mr-2"></i>
                    <div>
                        <p class="font-semibold text-red-800 text-sm">Erreurs dans le formulaire</p>
                        <ul class="text-xs text-red-600 mt-1 space-y-1">
                            {% for field, errors in form.errors.items %}
                                {% for error in errors %}
                                    <li>{{ field }}: {{ error }}</li>
                                {% endfor %}
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Grid Principal - 3 Colonnes -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 p-4">
                
                <!-- Colonne 1: Informations Personnelles -->
                <div class="space-y-3">
                    <div class="flex items-center mb-2">
                        <div class="bg-yellow-500 w-1 h-4 rounded mr-2"></div>
                        <h3 class="text-sm font-bold text-gray-700 flex items-center">
                            <i class="fas fa-user text-yellow-500 mr-1 text-xs"></i>
                            Informations Personnelles
                        </h3>
                    </div>

                    <!-- Nom -->
                    <div class="space-y-1">
                        <label for="{{ form.nom.id_for_label }}" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-signature text-yellow-500 mr-1 text-xs"></i>
                            Nom <span class="text-red-500 ml-1">*</span>
                        </label>
                        {{ form.nom }}
                    </div>

                    <!-- Prénom -->
                    <div class="space-y-1">
                        <label for="{{ form.prenom.id_for_label }}" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-signature text-yellow-500 mr-1 text-xs"></i>
                            Prénom <span class="text-red-500 ml-1">*</span>
                        </label>
                        {{ form.prenom }}
                    </div>

                    <!-- Sexe -->
                    <div class="space-y-1">
                        <label for="{{ form.sexe.id_for_label }}" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-venus-mars text-yellow-500 mr-1 text-xs"></i>
                            Sexe <span class="text-red-500 ml-1">*</span>
                        </label>
                        {{ form.sexe }}
                    </div>

                    <!-- Date de Naissance -->
                    <div class="space-y-1">
                        <label for="{{ form.date_naissance.id_for_label }}" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-calendar-day text-yellow-500 mr-1 text-xs"></i>
                            Date Naissance <span class="text-red-500 ml-1">*</span>
                        </label>
                        {{ form.date_naissance }}
                    </div>

                    <!-- Lieu de Naissance -->
                    <div class="space-y-1">
                        <label for="{{ form.lieu_naissance.id_for_label }}" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-map-marker-alt text-yellow-500 mr-1 text-xs"></i>
                            Lieu Naissance <span class="text-red-500 ml-1">*</span>
                        </label>
                        {{ form.lieu_naissance }}
                    </div>
                </div>

                <!-- Colonne 2: Informations Professionnelles -->
                <div class="space-y-3">
                    <div class="flex items-center mb-2">
                        <div class="bg-blue-500 w-1 h-4 rounded mr-2"></div>
                        <h3 class="text-sm font-bold text-gray-700 flex items-center">
                            <i class="fas fa-briefcase text-blue-500 mr-1 text-xs"></i>
                            Informations Professionnelles
                        </h3>
                    </div>

                    <!-- Spécialité -->
                    <div class="space-y-1">
                        <label for="{{ form.specialite.id_for_label }}" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-graduation-cap text-yellow-500 mr-1 text-xs"></i>
                            Spécialité <span class="text-red-500 ml-1">*</span>
                        </label>
                        {{ form.specialite }}
                    </div>

                    <!-- Diplôme -->
                    <div class="space-y-1">
                        <label for="{{ form.diplome.id_for_label }}" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-file-certificate text-yellow-500 mr-1 text-xs"></i>
                            Diplôme <span class="text-red-500 ml-1">*</span>
                        </label>
                        {{ form.diplome }}
                    </div>

                    <!-- Date Recrutement -->
                    <div class="space-y-1">
                        <label for="{{ form.date_recrutement.id_for_label }}" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-calendar-alt text-yellow-500 mr-1 text-xs"></i>
                            Date Recrutement <span class="text-red-500 ml-1">*</span>
                        </label>
                        {{ form.date_recrutement }}
                    </div>

                    <!-- Statut -->
                    <div class="space-y-1">
                        <label for="{{ form.statut.id_for_label }}" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-info-circle text-yellow-500 mr-1 text-xs"></i>
                            Statut <span class="text-red-500 ml-1">*</span>
                        </label>
                        {{ form.statut }}
                    </div>

                    <!-- Matières -->
                    <div class="space-y-1">
                        <label for="{{ form.matieres.id_for_label }}" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-book text-yellow-500 mr-1 text-xs"></i>
                            Matières enseignées
                        </label>
                        {{ form.matieres }}
                    </div>
                </div>

                <!-- Colonne 3: Contact & Autres -->
                <div class="space-y-3">
                    <div class="flex items-center mb-2">
                        <div class="bg-purple-500 w-1 h-4 rounded mr-2"></div>
                        <h3 class="text-sm font-bold text-gray-700 flex items-center">
                            <i class="fas fa-address-book text-purple-500 mr-1 text-xs"></i>
                            Contact & Autres
                        </h3>
                    </div>

                    <!-- Téléphone -->
                    <div class="space-y-1">
                        <label for="{{ form.telephone.id_for_label }}" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-phone text-yellow-500 mr-1 text-xs"></i>
                            Téléphone <span class="text-red-500 ml-1">*</span>
                        </label>
                        {{ form.telephone }}
                    </div>

                    <!-- Email -->
                    <div class="space-y-1">
                        <label for="{{ form.email.id_for_label }}" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-envelope text-yellow-500 mr-1 text-xs"></i>
                            Email
                        </label>
                        {{ form.email }}
                    </div>

                    <!-- Photo -->
                    <div class="space-y-1">
                        <label for="{{ form.photo.id_for_label }}" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-camera text-yellow-500 mr-1 text-xs"></i>
                            Photo
                        </label>
                        {{ form.photo }}
                    </div>

                    <!-- Adresse -->
                    <div class="space-y-1">
                        <label for="{{ form.adresse.id_for_label }}" class="block text-xs font-semibold text-gray-600 flex items-center">
                            <i class="fas fa-home text-yellow-500 mr-1 text-xs"></i>
                            Adresse <span class="text-red-500 ml-1">*</span>
                        </label>
                        {{ form.adresse }}
                    </div>
                </div>
            </div>

            <!-- Buttons Section -->
            <div class="bg-gray-50 p-4 border-t border-gray-200 rounded-b-lg">
                <div class="flex flex-col sm:flex-row items-center justify-between gap-3">
                    <a href="{% url 'enseignants:enseignants' %}" 
                        class="w-full sm:w-auto px-4 py-2 bg-gray-400 hover:bg-gray-500 text-white text-sm font-medium rounded-lg transition-all flex items-center justify-center space-x-2 order-2 sm:order-1">
                        <i class="fas fa-times text-xs"></i>
                        <span>Annuler</span>
                    </a>
                    
                    <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto order-1 sm:order-2">
                        <button type="reset" 
                            class="w-full sm:w-auto px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white text-sm font-medium rounded-lg transition-all flex items-center justify-center space-x-2">
                            <i class="fas fa-redo text-xs"></i>
                            <span>Réinitialiser</span>
                        </button>
                        
                        <button type="submit" 
                            class="w-full sm:w-auto px-6 py-2 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white text-sm font-bold rounded-lg transition-all flex items-center justify-center space-x-2 shadow-md">
                            <i class="fas fa-check-circle text-xs"></i>
                            <span>Enregistrer</span>
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Style CSS pour les 3 colonnes -->
<style>
    /* Style de base pour tous les champs */
    input, select, textarea {
        @apply w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-yellow-500 text-sm transition-all duration-200;
    }

    /* Style pour les textareas */
    textarea {
        resize: vertical;
        min-height: 80px;
    }

    /* Style pour les selects */
    select {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 0.5rem center;
        background-repeat: no-repeat;
        background-size: 1em 1em;
        padding-right: 2rem;
    }

    /* Style pour les fichiers */
    input[type="file"] {
        @apply border-dashed;
    }

    /* Layout 3 colonnes optimisé */
    @media (min-width: 1024px) {
        .lg\:grid-cols-3 {
            grid-template-columns: repeat(3, minmax(0, 1fr));
        }
        
        .space-y-3 > * + * {
            margin-top: 0.75rem;
        }
    }

    /* Responsivité pour tablettes */
    @media (max-width: 1024px) and (min-width: 768px) {
        .lg\:grid-cols-3 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }
    }

    /* Responsivité pour mobiles */
    @media (max-width: 767px) {
        .lg\:grid-cols-3 {
            grid-template-columns: 1fr;
        }
        
        .container {
            padding-left: 0.5rem;
            padding-right: 0.5rem;
        }
        
        input, select, textarea {
            font-size: 16px;
            min-height: 44px;
        }
        
        .p-4 {
            padding: 1rem;
        }
    }

    /* Très petits écrans */
    @media (max-width: 480px) {
        .text-lg {
            font-size: 1.125rem;
        }
        
        .space-y-1 > * + * {
            margin-top: 0.25rem;
        }
    }

    /* Animations au focus */
    input:focus, select:focus, textarea:focus {
        transform: translateY(-1px);
    }

    /* Empêcher le zoom sur iOS */
    @media (max-width: 480px) {
        input[type="text"],
        input[type="tel"],
        input[type="email"],
        input[type="date"],
        select,
        textarea {
            font-size: 16px;
        }
    }

    /* Style pour les erreurs */
    .error {
        @apply border-red-500 bg-red-50;
    }
</style>

<!-- Scripts optimisés -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Appliquer les styles aux champs Django
    const inputs = document.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
        if (!input.classList.contains('px-3')) {
            input.classList.add('w-full', 'px-3', 'py-2', 'border', 'border-gray-300', 'rounded-lg', 'focus:outline-none', 'focus:ring-1', 'focus:ring-yellow-500', 'text-sm');
        }
    });

    // Auto-format du téléphone
    const phoneInput = document.querySelector('input[type="tel"]');
    if (phoneInput) {
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.startsWith('509')) {
                value = value.substring(3);
            }
            if (value.length > 0) {
                value = '+509 ' + value;
            }
            if (value.length > 9) {
                value = value.substring(0, 9) + '-' + value.substring(9, 13);
            }
            e.target.value = value;
        });
    }

    // Validation en temps réel
    const form = document.getElementById('enseignantForm');
    if (form) {
        const requiredFields = form.querySelectorAll('[required]');
        
        requiredFields.forEach(field => {
            field.addEventListener('blur', function() {
                if (!this.value.trim()) {
                    this.classList.add('border-red-500', 'bg-red-50');
                } else {
                    this.classList.remove('border-red-500', 'bg-red-50');
                }
            });

            field.addEventListener('input', function() {
                if (this.value.trim()) {
                    this.classList.remove('border-red-500', 'bg-red-50');
                }
            });
        });

        // Validation avant soumission
        form.addEventListener('submit', function(e) {
            let isValid = true;
            const emptyFields = [];

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    emptyFields.push(field.previousElementSibling?.textContent?.trim() || 'Champ requis');
                    field.classList.add('border-red-500', 'bg-red-50');
                }
            });

            if (!isValid) {
                e.preventDefault();
                alert('Veuillez remplir tous les champs obligatoires.');
                
                // Scroll vers le premier champ vide
                const firstEmpty = document.querySelector('.border-red-500');
                if (firstEmpty) {
                    firstEmpty.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstEmpty.focus();
                }
            }
        });
    }

    // Confirmation avant réinitialisation
    const resetButton = document.querySelector('button[type="reset"]');
    if (resetButton) {
        resetButton.addEventListener('click', function(e) {
            if (!confirm('Êtes-vous sûr de vouloir réinitialiser tous les champs du formulaire ?')) {
                e.preventDefault();
            }
        });
    }
});
</script>
{% endblock %}